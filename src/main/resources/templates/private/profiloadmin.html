<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pannello Admin - Gestione Candidature</title>
  <link rel="stylesheet" th:href="@{/css/profiloadmin.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>

<body>
  <header class="admin-header">
    <h1>
      <img th:src="@{/image/logo2.png}" alt="logo" height="100">
      Pannello di Amministrazione
    </h1>
    <nav class="header-nav-links">
      <a th:href="@{/dashboard}" class="nav-btn"><i class="fas fa-table-columns"></i> Dashboard</a>
      <a th:href="@{/profilo}" class="nav-btn"><i class="fas fa-user-circle"></i> Area Utente</a>
      <form th:action="@{/logout}" method="post" style="display: inline;">
        <button type="submit" class="nav-btn logout" style="border:none; background:none; cursor:pointer; padding:0; font-family:inherit; font-size:inherit; color:inherit;">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </form>
    </nav>
  </header>

  <main class="admin-container">
    <div th:if="${successMessage}" class="feedback-message success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="feedback-message error" th:text="${errorMessage}"></div>

    <section class="section-table">
      <div class="section-header">
        <h2><i class="fas fa-file-alt"></i> Candidature Ricevute</h2>
        <button id="openModal" class="btn-add"><i class="fas fa-plus"></i> Aggiungi Tirocinio</button>
      </div>
      <p class="section-subtitle">Lista completa delle persone candidate ai tirocini pubblicati.</p>

      <div class="table-wrapper">
        <table class="candidature-table">
          <thead>
            <tr>
              <th>Candidato</th>
              <th>Titolo Tirocinio</th>
              <th>Stato</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="candidatura : ${listaCandidature}">
              <td th:text="${candidatura.nomeUtente + ' ' + candidatura.cognomeUtente}">Mario Rossi</td>
              <td th:text="${candidatura.mansioneTirocinio}">Frontend Developer</td>
              <td>
                <span class="status"
                      th:classappend="${candidatura.stato == 'Accettata' ? 'status-accepted' : (candidatura.stato == 'Rifiutata' ? 'status-rejected' : 'status-pending')}"
                      th:text="${candidatura.stato}">
                  In Attesa
                </span>
              </td>
              <td class="action-buttons">
                <button class="btn-action view"><i class="fas fa-eye"></i></button>
                
                <form th:action="@{/admin/candidature/{id}/accetta(id=${candidatura.id_candidatura})}" method="post" style="display:inline;">
                    <button type="submit" class="btn-action accept" title="Accetta"><i class="fas fa-check"></i></button>
                </form>
                
                <form th:action="@{/admin/candidature/{id}/rifiuta(id=${candidatura.id_candidatura})}" method="post" style="display:inline;">
                    <button type="submit" class="btn-action reject" title="Rifiuta"><i class="fas fa-times"></i></button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">&times;</span>
      <h2><i class="fas fa-plus-square"></i> Aggiungi Tirocinio</h2>

      <form class="tirocinio-form" th:action="@{/registraTirocinio}" th:object="${nuovoTirocinio}" method="post">
        <div class="form-group">
          <label for="titolo">Titolo Tirocinio:</label>
          <input type="text" id="titolo" th:field="*{mansione}" placeholder="Esempio: Sviluppatore Java" required>
        </div>

        <div class="form-group">
          <label for="azienda">Azienda:</label>
          <select id="azienda" th:field="*{aziendaId}" required>
            <option value="" disabled selected>Seleziona un'azienda</option>
            <option th:each="az : ${listaAziende}"
                    th:value="${az.idAzienda}"
                    th:text="${az.nome}"></option>
          </select>
        </div>

		<div class="form-group">
		  <label for="durata">Durata (Mesi):</label>
		  <input type="number" id="durata" th:field="*{durata}" min="1" max="12" placeholder="1-12" required>
		</div>

        <div class="form-group">
          <label for="orari">Orari di Lavoro:</label>
          <input type="text" id="orari" th:field="*{orari}" placeholder="Full-time / Part-time / Flessibile">
        </div>

        <div class="form-group full-width">
          <label>Competenze:</label>
          <div class="tag-select">
            <div th:each="comp : ${listaCompetenze}" class="skill-tag-checkbox">
              <input type="checkbox" th:id="${'comp-' + comp.idCompetenza}" th:field="*{competenzeId}" th:value="${comp.idCompetenza}">
              <label th:for="${'comp-' + comp.idCompetenza}" th:text="${comp.nome}"></label>
            </div>
          </div>
        </div>
        
        <div class="form-group full-width">
          <label for="descrizione">Descrizione:</label>
          <textarea id="descrizione" th:field="*{descrizione}" rows="3" placeholder="Descrizione del tirocinio"></textarea>
        </div>

        <div class="form-actions full-width">
          <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Salva</button>
          <button type="reset" class="btn-secondary"><i class="fas fa-eraser"></i> Svuota</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('modal');
        const openModalBtn = document.getElementById('openModal');
        const closeModalBtn = document.getElementById('closeModal');

        if (openModalBtn) {
            openModalBtn.onclick = () => modal.style.display = 'flex';
        }
        if (closeModalBtn) {
            closeModalBtn.onclick = () => modal.style.display = 'none';
        }
        window.onclick = e => { 
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        };
    });
  </script>
</body>
</html>